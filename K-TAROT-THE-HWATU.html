<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>K-Tarot Â· The Hwatu â€“ A+B Short Reading</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600&display=swap" rel="stylesheet">

<style>
/* ===============================
   ì „ì²´ í˜ì´ì§€ë¥¼ í•˜ë‚˜ì˜ í° ì¹´ë“œë¡œ ê°ì‹¼ë‹¤
================================*/
body {
  margin: 0;
  min-height: 100vh;
  padding: 0;
  display: flex;
  justify-content: center;
  background:
    radial-gradient(circle at 10% 0%, #5846ff 0, transparent 55%),
    radial-gradient(circle at 80% 100%, #f74f7a33 0, transparent 60%),
    radial-gradient(circle at 0% 100%, #16d9ff33 0, transparent 60%),
    #050014;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  overflow-y: auto;
  overflow-x: hidden;
}

/* ğŸ”¥ í° ì¹´ë“œ â€” ì „ì²´ ì•±ì„ ì´ ë°•ìŠ¤ ì•ˆì— ë„£ìŒ */
.page-card {
  width: min(430px, 94vw);
  margin: 20px auto;
  padding: 20px 14px 26px;
  border-radius: 26px;

  background: rgba(0, 0, 0, 0.42);
  box-shadow:
    0 18px 40px rgba(0,0,0,0.9),
    0 0 70px rgba(150,120,255,0.55);

  box-sizing: border-box;
  overflow: hidden; /* ì ˆëŒ€ ë„˜ì¹˜ì§€ ì•Šë„ë¡ */
}

/* ===============================
   ë‚´ë¶€ ì•± êµ¬ì¡° ê·¸ëŒ€ë¡œ ìœ ì§€
================================*/
.app {
  width: 100%;
  max-width: 100%;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 16px;
  border-radius: 999px;
  border: 1px solid rgba(255, 224, 170, 0.95);
  background:
    radial-gradient(circle at 0% 0%, rgba(255,255,255,0.2), transparent 55%),
    linear-gradient(135deg, rgba(60,34,8,0.95), rgba(120,76,20,0.95));
  color: #fde3a9;
  font-size: 0.95rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

/* App Shell (ì»¨í…ì¸  ì¹´ë“œ) */
.app-shell {
  width: 100%;
  border-radius: 26px;
  padding: 22px 16px 24px;
  background:
    radial-gradient(circle at top, rgba(255,255,255,0.09), transparent 60%),
    radial-gradient(circle at bottom, rgba(0,0,0,0.95), transparent 70%),
    linear-gradient(145deg, #1a0f3b 0%, #070315 50%, #240628 100%);
  box-shadow: 0 18px 80px rgba(0,0,0,0.5);
  border: 1px solid rgba(255,255,255,0.12);
  overflow: hidden;
  box-sizing: border-box;
}

.lang-toggle {
  position: absolute;
  top: 8px;
  right: 10px;
  display: flex;
  gap: 4px;
}

.lang-btn {
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.35);
  background: rgba(6,3,20,0.6);
  color: #f8ecff;
  font-size: 0.65rem;
  padding: 2px 7px;
  cursor: pointer;
}
.lang-btn.active {
  background: linear-gradient(135deg, #ffc658, #ff8ae6);
  color: #1b0d1f;
}

/* HEADER */
.app-header {
  text-align: center;
  margin-bottom: 10px;
}
.app-title {
  font-family: "Cinzel", serif;
  font-size: 1.35rem;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: #fde3a9;
}
.app-title::after {
  content: "âœ¶";
  display: block;
  font-size: 1.8rem;
  margin-top: 4px;
  color: #65f8ff;
}
.app-tagline {
  margin-top: 6px;
  font-size: 0.9rem;
  color: #9fd6ff;
}

/* Screens */
.screen { display: flex; flex-direction: column; align-items: center; gap: 10px; }
.hidden { display: none !important; }

.step-title {
  font-size: 1rem;
  font-weight: 600;
  color: #ffe8b6;
  text-align: center;
}
.step-text, .helper-text {
  font-size: 0.9rem;
  color: #c8c0f0;
  text-align: center;
  line-height: 1.4;
}

/* ìˆ«ì ë²„íŠ¼ */
.btn-row {
  width: 100%;
  display: flex;
  gap: 6px;
  overflow-x: auto;
  padding-bottom: 6px;
}
.num-btn {
  min-width: 40px;
  height: 40px;
  border-radius: 999px;
  border: 1px solid rgba(255,214,140,0.8);
  background:
    radial-gradient(circle at 30% 0%, rgba(255,255,255,0.2), transparent 60%),
    linear-gradient(140deg, #2d214d, #15152f);
  color: #fde3a9;
  font-size: 1rem;
  font-weight: 600;
}
.num-btn.active {
  background: linear-gradient(150deg, #ffc958, #ff7f55);
  color: #2b1200;
}

/* ì¹´ë“œ */
.card { width: 80%; max-width: 260px; aspect-ratio: 3/5; border-radius: 22px; overflow: hidden; }
.card-slot.small .card { width: 26vw; max-width: 120px; }

.card-back-img { width: 100%; height: 100%; object-fit: cover; }

/* Result Card 3D */
.card-3d { width: 80%; max-width: 260px; aspect-ratio: 3/5; position: relative; perspective: 1000px; cursor: pointer; }
.card-3d-inner { width: 100%; height: 100%; transition: transform .7s; transform-style: preserve-3d; }
.card-3d.flipped .card-3d-inner { transform: rotateY(180deg); }

.card-face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 20px; overflow: hidden; }
.card-front { background-size: cover; background-position: center; }
.card-back {
  transform: rotateY(180deg);
  padding: 10px;
  background: linear-gradient(180deg, #0f0a22, #02010a);
  border: 1px solid rgba(249,226,176,0.65);
}
.reading-title { text-align: center; color: #fde3a9; letter-spacing: 0.4em; font-size: 0.9rem; margin-bottom: 4px; }
.reading-body { font-size: 0.9rem; color: white; line-height: 1.45; white-space: pre-wrap; }

/* Again Button */
.secondary-btn {
  margin-top: 12px;
  padding: 8px 16px;
  border-radius: 999px;
  font-size: 1.2rem;
  border: 1px solid rgba(151,132,255,0.9);
  color: #e2ddff;
  cursor: pointer;
  background: linear-gradient(140deg,rgba(50,32,120,0.95),rgba(18,11,60,0.98));
}

/* Responsive */
@media (max-width: 480px) {
  .page-card { width: 94vw; }
  .app-shell { padding: 18px 12px; }
  .reading-body { font-size: 0.85rem; }
}
</style>
</head>

<body>

<!-- ì „ì²´ ì•±ì„ ê°ì‹¸ëŠ” ëŒ€í˜• ì¹´ë“œ -->
<div class="page-card">

  <audio id="flip-sound" src="sounds/card-flip-sound.mp3" preload="auto"></audio>

  <div class="app">

    <div class="badge">
      <span>ğŸ”®</span>
      <span id="badge-label">K-SISTERS Â· K-Tarot Reading</span>
    </div>

    <div class="app-shell">

      <!-- ì–¸ì–´ ì„ íƒ -->
      <div class="lang-toggle">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="fr">FR</button>
      </div>

      <!-- HEADER -->
      <div class="app-header">
        <div class="app-title" id="app-title-text">K-TAROT: THE HWATU</div>
        <div class="app-tagline" id="app-tagline">
          Focus on a question, choose a number, then let one Hwatu card find you. âœ¦
        </div>
      </div>

      <!-- SCREEN 1 -->
      <section id="screen-intro" class="screen">
        <div class="card-slot large" id="intro-card-slot"></div>
        <div class="step-title" id="step1-title">1. Choose how many times you want to â€œshuffleâ€.</div>
        <div class="step-text" id="step1-text">
          Pick a number from 0â€“9. That number quietly becomes the energetic tone behind your reading.
        </div>

        <div class="btn-row" id="number-buttons">
          <button class="num-btn" data-num="0">0</button>
          <button class="num-btn" data-num="1">1</button>
          <button class="num-btn" data-num="2">2</button>
          <button class="num-btn" data-num="3">3</button>
          <button class="num-btn" data-num="4">4</button>
          <button class="num-btn" data-num="5">5</button>
          <button class="num-btn" data-num="6">6</button>
          <button class="num-btn" data-num="7">7</button>
          <button class="num-btn" data-num="8">8</button>
          <button class="num-btn" data-num="9">9</button>
        </div>

        <div class="helper-text" id="helper1">
          Take a breath, think of your question, then tap the number that feels right.
        </div>
      </section>

      <!-- SCREEN 2 -->
      <section id="screen-pick" class="screen hidden">
        <div class="step-title" id="step2-title">2. Let one Hwatu card find you.</div>
        <div class="step-text" id="step2-text">
          Three cards are waiting. Choose the one that pulls your eye first.
        </div>

        <div class="card-row">
          <div class="card-slot small"><button class="card-button" data-slot="0"></button></div>
          <div class="card-slot small"><button class="card-button" data-slot="1"></button></div>
          <div class="card-slot small"><button class="card-button" data-slot="2"></button></div>
        </div>

        <div class="helper-text" id="helper2">
          Only the first card you pick will speak for this reading.
        </div>
      </section>

      <!-- SCREEN 3 -->
      <section id="screen-result" class="screen hidden">
        <div class="step-title" id="step3-title">3. Your reading for this moment</div>

        <div class="result-card-wrapper">
          <div id="result-card-slot"></div>
        </div>

        <button class="secondary-btn" id="again-btn">
          Draw again <span>â†»</span>
        </button>
      </section>

    </div>
  </div>
</div>

<!-- ì¹´ë“œ ë’·ë©´ -->
<template id="card-back-template">
  <div class="card">
    <img src="images/hwatu/hwatu_card_back.png" class="card-back-img" />
  </div>
</template>

<script>
/* ============================
   UI STRINGS (EN / FR)
===============================*/
const UI_STRINGS = {
  en: {
    badge: "K-SISTERS Â· K-Tarot Reading",
    title: "K-TAROT: THE HWATU",
    tagline: "Focus on a question, choose a number, then let one Hwatu card find you. âœ¦",
    step1Title: "1. Choose how many times you want to â€œshuffleâ€.",
    step1Text: "Pick a number from 0â€“9. That number quietly becomes the energetic tone behind your reading.",
    helper1: "Take a breath, think of your question, then tap the number that feels right.",
    step2Title: "2. Let one Hwatu card find you.",
    step2Text: "Three cards are waiting. When youâ€™re ready, choose the one that pulls your eye first.",
    helper2: "Only the first card you pick will speak for this reading.",
    step3Title: "3. Your reading for this moment",
    againBtn: "Draw again",
    overlayTap: "Tap to reveal meaning",
    readingTitle: "MESSAGE",
    combinedLine: "Together, this combination suggests that these themes may be especially active for you right now. Notice where they show up in your day. âœ¦"
  },
  fr: {
    badge: "K-SISTERS Â· Lecture K-Tarot",
    title: "K-TAROT : LE HWATU",
    tagline: "Concentre-toi sur une question, choisis un nombre, puis laisse une carte de Hwatu venir Ã  toi. âœ¦",
    step1Title: "1. Choisis combien de fois tu veux Â« mÃ©langer Â».",
    step1Text: "Choisis un nombre de 0 Ã  9. Ce nombre devient tranquillement le ton Ã©nergÃ©tique de ta lecture.",
    helper1: "Inspire doucement, pense Ã  ta question, puis touche le chiffre qui te semble juste.",
    step2Title: "2. Laisse une carte de Hwatu te choisir.",
    step2Text: "Trois cartes tâ€™attendent. Quand tu es prÃªtÂ·e, choisis celle qui attire ton regard en premier.",
    helper2: "Seule la premiÃ¨re carte que tu choisis parlera pour cette lecture.",
    step3Title: "3. Ton message pour ce moment",
    againBtn: "Tirer une nouvelle carte",
    overlayTap: "Tape pour rÃ©vÃ©ler le message",
    readingTitle: "MESSAGE",
    combinedLine: "Ensemble, cette combinaison indique que ces thÃ¨mes sont particuliÃ¨rement actifs pour toi en ce moment. Observe oÃ¹ ils apparaissent dans ta journÃ©e. âœ¦"
  }
};

let currentLang = "en";

/* ============================
   DATA â€“ Hwatu + Angel Meanings
===============================*/

// Hwatu A1~A12 (index 0~11)
const HWATU_MEANINGS = [
  {
    label_en: "The Crane Â· New message & baby energy",
    text_en: "New announcements and the energy of fresh beginnings, including the possibility of something like a baby or a new project being born in your life.",
    label_fr: "La Grue Â· Nouveau message & Ã©nergie de bÃ©bÃ©",
    text_fr: "Nouveaux messages et Ã©nergie de commencement, y compris la possibilitÃ© quâ€™un Â« bÃ©bÃ© Â» apparaisse dans ta vie â€“ un enfant, un projet ou une idÃ©e toute neuve."
  },
  {
    label_en: "The Plum Blossom Â· Lover & new romance",
    text_en: "The energy of lovers and attraction, suggesting that a new romantic connection or crush may begin or feel warmer.",
    label_fr: "La Fleur de prunier Â· Amour & nouvelle romance",
    text_fr: "Lâ€™Ã©nergie des amoureux et de lâ€™attirance, qui suggÃ¨re quâ€™une nouvelle connexion romantique ou un crush peut commencer ou devenir plus chaleureux."
  },
  {
    label_en: "The Cherry Blossom Â· Meetings & dates",
    text_en: "The energy of meetings, dates, and spending time together in ways that deepen connection step by step.",
    label_fr: "La Fleur de cerisier Â· Rencontres & rendez-vous",
    text_fr: "Lâ€™Ã©nergie des rencontres, des rendez-vous et des moments passÃ©s ensemble, qui approfondissent peu Ã  peu la connexion."
  },
  {
    label_en: "The Bush Clover Â· Gossip & drama",
    text_en: "The energy of gossip and rumors, hinting that you could be pulled into misunderstandings or drama if you donâ€™t protect your boundaries.",
    label_fr: "Le TrÃ¨fle des buissons Â· Potins & drama",
    text_fr: "Lâ€™Ã©nergie des potins et des rumeurs, qui montre que tu peux Ãªtre entraÃ®nÃ©Â·e dans des malentendus ou du drama si tu ne protÃ¨ges pas tes limites."
  },
  {
    label_en: "The Iris Â· Food, marriage & celebration",
    text_en: "Shared meals, weddings, and celebrations, showing chances to be invited to happy events or gatherings.",
    label_fr: "Lâ€™Iris Â· Repas, mariage & cÃ©lÃ©bration",
    text_fr: "Repas partagÃ©s, mariages et cÃ©lÃ©brations, qui indiquent des invitations Ã  des Ã©vÃ©nements heureux ou des rÃ©unions chaleureuses."
  },
  {
    label_en: "The Peony Â· Good omen & happy surprise",
    text_en: "A bright, lucky omen that suggests unexpected good news or a pleasant surprise arriving into your day.",
    label_fr: "La Pivoine Â· Bon prÃ©sage & heureuse surprise",
    text_fr: "Un heureux prÃ©sage lumineux qui annonce une bonne nouvelle inattendue ou une surprise agrÃ©able qui entre dans ta journÃ©e."
  },
  {
    label_en: "The Wild Boar Â· Good fortune & money flow",
    text_en: "Good luck and increased resources, pointing to situations where money or practical support may come in more easily.",
    label_fr: "Le Sanglier Â· Chance & flux dâ€™argent",
    text_fr: "Bonne chance et ressources qui augmentent, indiquant des situations oÃ¹ lâ€™argent ou le soutien matÃ©riel peuvent arriver plus facilement."
  },
  {
    label_en: "The Moon Â· Late night, worries & pleasure",
    text_en: "Late-night energy that blends worries with nightlife and fun, hinting at both emotional heaviness and release through play or entertainment.",
    label_fr: "La Lune Â· Nuit tardive, soucis & plaisir",
    text_fr: "Ã‰nergie de nuit tardive mÃªlÃ©e de soucis, de sorties et de plaisir, qui montre Ã  la fois un poids Ã©motionnel et un besoin de se libÃ©rer par le jeu ou la fÃªte."
  },
  {
    label_en: "The Chrysanthemum Â· Drinks & socializing",
    text_en: "The energy of drinking and social gatherings, bringing moments to relax, open up, and share deeper thoughts with others.",
    label_fr: "Le ChrysanthÃ¨me Â· Verres & sociabilitÃ©",
    text_fr: "Lâ€™Ã©nergie des verres partagÃ©s et des rencontres sociales, avec des moments pour se dÃ©tendre, sâ€™ouvrir et partager des pensÃ©es plus profondes."
  },
  {
    label_en: "The Deer Â· Concern & overthinking",
    text_en: "The energy of concern and mental load, pointing to worries or burdens that may feel heavier than usual if you carry them alone.",
    label_fr: "Le Daim Â· Soucis & trop rÃ©flÃ©chir",
    text_fr: "Lâ€™Ã©nergie des prÃ©occupations et de la charge mentale, qui signale des soucis ou des poids plus lourds si tu les portes seulÂ·e."
  },
  {
    label_en: "The Kappa Â· Money luck & resources",
    text_en: "Strong money luck and material support, suggesting that income, savings, or financial help may increase or stabilise.",
    label_fr: "Le Kappa Â· Chance financiÃ¨re & ressources",
    text_fr: "Une forte chance financiÃ¨re et un soutien matÃ©riel, qui suggÃ¨rent que tes revenus, Ã©conomies ou aides financiÃ¨res peuvent augmenter ou se stabiliser."
  },
  {
    label_en: "The Rain Â· Unexpected visitor",
    text_en: "The energy of unexpected guestsâ€”people, messages, or chances that suddenly appear and gently shift your plans or direction.",
    label_fr: "La Pluie Â· Visiteur inattendu",
    text_fr: "Lâ€™Ã©nergie des visites inattendues â€“ personnes, messages ou opportunitÃ©s qui apparaissent soudainement et changent doucement tes plans ou ta direction."
  }
];

// Angel B1~B10 (index 0~9)
const ANGEL_MEANINGS = [
  {
    label_en: "000 Â· Infinite potential",
    text_en: "Infinite potential and a fresh start. You are deeply connected to the universe, with endless possibilities available to you right now.",
    label_fr: "000 Â· Potentiel infini",
    text_fr: "Potentiel infini et nouveau dÃ©part. Tu es profondÃ©ment connectÃ©Â·e Ã  lâ€™univers, avec dâ€™innombrables possibilitÃ©s disponibles pour toi maintenant."
  },
  {
    label_en: "111 Â· New beginnings & manifestation",
    text_en: "A powerful sign of new beginnings and manifestation. Your thoughts are turning into reality quickly, so keep your mindset clear and positive.",
    label_fr: "111 Â· Nouveau dÃ©part & manifestation",
    text_fr: "Signe puissant de nouveau dÃ©part et de manifestation. Tes pensÃ©es deviennent rÃ©alitÃ© trÃ¨s vite, alors garde un esprit clair et positif."
  },
  {
    label_en: "222 Â· Balance & harmony",
    text_en: "Balance, harmony, and trust in divine timing. You are in the right place at the right time, especially in relationships and partnerships.",
    label_fr: "222 Â· Ã‰quilibre & harmonie",
    text_fr: "Ã‰quilibre, harmonie et confiance dans le timing divin. Tu es au bon endroit au bon moment, surtout dans tes relations et partenariats."
  },
  {
    label_en: "333 Â· Guidance & creativity",
    text_en: "Your spiritual guides are close, offering support and encouragement. You are invited to express your creativity and unique talents more boldly.",
    label_fr: "333 Â· Guidance & crÃ©ativitÃ©",
    text_fr: "Tes guides spirituels sont proches, tâ€™offrant soutien et encouragement. Tu es invitÃ©Â·e Ã  exprimer ta crÃ©ativitÃ© et tes talents uniques plus ouvertement."
  },
  {
    label_en: "444 Â· Protection & stability",
    text_en: "Protection, grounding, and stability. Your efforts to build a strong foundation are supported, and you are allowed to worry less and trust more.",
    label_fr: "444 Â· Protection & stabilitÃ©",
    text_fr: "Protection, ancrage et stabilitÃ©. Tes efforts pour construire une base solide sont soutenus : tu peux tâ€™inquiÃ©ter moins et faire davantage confiance."
  },
  {
    label_en: "555 Â· Change & transformation",
    text_en: "Big change and transformation are on the horizon. Stay flexible, release what no longer serves you, and welcome the new opportunities arriving.",
    label_fr: "555 Â· Changement & transformation",
    text_fr: "Un grand changement et une transformation sont Ã  lâ€™horizon. Reste flexible, libÃ¨re ce qui ne te sert plus et accueille les nouvelles opportunitÃ©s."
  },
  {
    label_en: "666 Â· Balance & self-care",
    text_en: "A call for balance between material and spiritual life. It nudges you toward honest self-reflection, self-care, and healthier priorities.",
    label_fr: "666 Â· RÃ©Ã©quilibrage & soin de soi",
    text_fr: "Un appel Ã  rÃ©Ã©quilibrer vie matÃ©rielle et vie intÃ©rieure. Cela te pousse vers une vraie introspection, plus de soin de toi et des prioritÃ©s plus saines."
  },
  {
    label_en: "777 Â· Luck & spiritual awakening",
    text_en: "Luck, spiritual awakening, and inner wisdom. It is a sign to trust your intuition, let go of fear, and recognise that you are being guided.",
    label_fr: "777 Â· Chance & Ã©veil spirituel",
    text_fr: "Chance, Ã©veil spirituel et sagesse intÃ©rieure. Câ€™est un signe que tu peux faire confiance Ã  ton intuition, lÃ¢cher la peur et reconnaÃ®tre que tu es guidÃ©Â·e."
  },
  {
    label_en: "888 Â· Abundance & success",
    text_en: "Abundance, financial success, and infinite potential. Prosperity and recognition are on their way as you align with the flow of energy.",
    label_fr: "888 Â· Abondance & succÃ¨s",
    text_fr: "Abondance, succÃ¨s financier et potentiel infini. ProspÃ©ritÃ© et reconnaissance arrivent Ã  mesure que tu tâ€™alignes avec le flux de lâ€™Ã©nergie."
  },
  {
    label_en: "999 Â· Completion & new cycle",
    text_en: "Completion and the end of a major cycle. You are encouraged to release the old so that new beginnings and personal evolution can fully enter.",
    label_fr: "999 Â· AchÃ¨vement & nouveau cycle",
    text_fr: "AchÃ¨vement et fin dâ€™un grand cycle. Tu es encouragÃ©Â·e Ã  laisser partir lâ€™ancien pour que de nouveaux commencements et une Ã©volution personnelle puissent entrer pleinement."
  }
];

// Hwatu ì¹´ë“œ ì´ë¯¸ì§€ (ì•ë©´)
const HWATU_CARD_IMAGES = [
  "images/hwatu/The_Crane.png",
  "images/hwatu/Plum_Blossom.png",
  "images/hwatu/Cherry_Blossom.png",
  "images/hwatu/Wisteria.png",
  "images/hwatu/Iris.png",
  "images/hwatu/Peony.png",
  "images/hwatu/Bush_Clover_and_wild-boar.png",
  "images/hwatu/The_Moon.png",
  "images/hwatu/Chrysanthemum_and_glass.png",
  "images/hwatu/Maple_tree_and_deer.png",
  "images/hwatu/Paulownia_leaves_and_phoenix.png",
  "images/hwatu/The_Scholar_and_Turtle.png"
];

/* ============================
   STATE
===============================*/
let selectedAngelIndex = null;   // 0â€“9
let currentHwatuIndices = [];    // ê¸¸ì´ 3, 0â€“11
let resultShown = false;
let lastHwatuIndex = null;
let lastAngelIndex = null;

/* ============================
   DOM
===============================*/
const screenIntro  = document.getElementById("screen-intro");
const screenPick   = document.getElementById("screen-pick");
const screenResult = document.getElementById("screen-result");

const introCardSlot  = document.getElementById("intro-card-slot");
const resultCardSlot = document.getElementById("result-card-slot");

const numberButtons = Array.from(document.querySelectorAll(".num-btn"));
const cardButtons   = Array.from(document.querySelectorAll(".card-button"));
const againBtn      = document.getElementById("again-btn");

const backTemplate  = document.getElementById("card-back-template");
const flipSoundEl   = document.getElementById("flip-sound");

const badgeLabel    = document.getElementById("badge-label");
const appTitleText  = document.getElementById("app-title-text");
const appTagline    = document.getElementById("app-tagline");
const step1TitleEl  = document.getElementById("step1-title");
const step1TextEl   = document.getElementById("step1-text");
const helper1El     = document.getElementById("helper1");
const step2TitleEl  = document.getElementById("step2-title");
const step2TextEl   = document.getElementById("step2-text");
const helper2El     = document.getElementById("helper2");
const step3TitleEl  = document.getElementById("step3-title");
const langButtons   = Array.from(document.querySelectorAll(".lang-btn"));

/* ============================
   HELPERS
===============================*/
function createBackCard() {
  return backTemplate.content.firstElementChild.cloneNode(true);
}

// introì— ë’·ë©´ ì¹´ë“œ 1ì¥
introCardSlot.appendChild(createBackCard());

// ì„ íƒ í™”ë©´ìš© ì¹´ë“œ 3ì¥
cardButtons.forEach(btn => {
  btn.appendChild(createBackCard());
});

function showScreen(name) {
  screenIntro.classList.toggle("hidden",  name !== "intro");
  screenPick.classList.toggle("hidden",   name !== "pick");
  screenResult.classList.toggle("hidden", name !== "result");
}

// 12ì¥ ì¤‘ 3ì¥ ëœë¤ ì„ íƒ
function dealHwatuCards() {
  const pool = [...Array(12).keys()];
  const picked = [];
  for (let i = 0; i < 3; i++) {
    const r = Math.floor(Math.random() * pool.length);
    picked.push(pool.splice(r, 1)[0]);
  }
  currentHwatuIndices = picked;
  resultShown = false;
  lastHwatuIndex = null;
  lastAngelIndex = null;
}

// A + B ì¡°í•© ë¦¬ë”© ë§Œë“¤ê¸° (ì–¸ì–´ë³„)
function buildReading(angelIndex, hwatuIndex) {
  const a = HWATU_MEANINGS[hwatuIndex];
  const b = ANGEL_MEANINGS[angelIndex];
  const ui = UI_STRINGS[currentLang];

  const aLabel = currentLang === "fr" ? a.label_fr : a.label_en;
  const aText  = currentLang === "fr" ? a.text_fr  : a.text_en;
  const bLabel = currentLang === "fr" ? b.label_fr : b.label_en;
  const bText  = currentLang === "fr" ? b.text_fr  : b.text_en;

  const line1 = `Energy â€“ ${aLabel}:\n${aText}`;
  const line2 = `\n\nMessage â€“ ${bLabel}:\n${bText}`;
  const line3 = `\n\n${ui.combinedLine}`;

  return line1 + line2 + line3;
}

function playFlipSound() {
  if (!flipSoundEl) return;
  try {
    flipSoundEl.currentTime = 0;
    flipSoundEl.play();
  } catch (e) {
    // ëª¨ë°”ì¼ ìë™ì¬ìƒ ì œí•œìš©, ì—ëŸ¬ ë¬´ì‹œ
  }
}

/* ============================
   LANGUAGE APPLY
===============================*/
function applyLanguage(lang) {
  currentLang = lang;
  document.documentElement.lang = lang;

  const ui = UI_STRINGS[lang];

  badgeLabel.textContent   = ui.badge;
  appTitleText.textContent = ui.title;
  appTagline.textContent   = ui.tagline;
  step1TitleEl.textContent = ui.step1Title;
  step1TextEl.textContent  = ui.step1Text;
  helper1El.textContent    = ui.helper1;
  step2TitleEl.textContent = ui.step2Title;
  step2TextEl.textContent  = ui.step2Text;
  helper2El.textContent    = ui.helper2;
  step3TitleEl.textContent = ui.step3Title;
  againBtn.firstChild.textContent = ui.againBtn + " ";

  langButtons.forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });

  // ê²°ê³¼ê°€ ì´ë¯¸ ë– ìˆìœ¼ë©´ í…ìŠ¤íŠ¸ë§Œ ê°±ì‹ 
  if (resultShown && lastAngelIndex !== null && lastHwatuIndex !== null) {
    const bodyEl = document.querySelector("#screen-result .reading-body");
    const titleEl = document.querySelector("#screen-result .reading-title");
    if (bodyEl && titleEl) {
      titleEl.textContent = ui.readingTitle;
      bodyEl.textContent = buildReading(lastAngelIndex, lastHwatuIndex);
    }
  }
}

/* ============================
   INTERACTIONS
===============================*/

// ì´ˆê¸° ì–¸ì–´ ì ìš©
applyLanguage("en");

// ì–¸ì–´ ë²„íŠ¼
langButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const lang = btn.dataset.lang;
    applyLanguage(lang);
  });
});

// ìˆ«ì ì„ íƒ
numberButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const num = Number(btn.dataset.num); // 0~9
    selectedAngelIndex = num;

    numberButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    setTimeout(() => {
      dealHwatuCards();
      showScreen("pick");
    }, 350);
  });
});

// ì¹´ë“œ ì„ íƒ â†’ ê²°ê³¼ í™”ë©´ + ì•ë©´ ì¹´ë“œ + flipìœ¼ë¡œ ë¦¬ë”©
cardButtons.forEach((btn, slotIndex) => {
  btn.addEventListener("click", () => {
    if (resultShown) return;
    if (selectedAngelIndex === null) return;

    resultShown = true;
    const hwatuIndex = currentHwatuIndices[slotIndex];
    lastHwatuIndex = hwatuIndex;
    lastAngelIndex = selectedAngelIndex;

    // ë‹¤ë¥¸ ë²„íŠ¼ ë¹„í™œì„±í™”
    cardButtons.forEach(b => b.classList.add("disabled"));

    const reading = buildReading(selectedAngelIndex, hwatuIndex);

    // ê²°ê³¼ ì¹´ë“œ ë Œë”
    resultCardSlot.innerHTML = "";

    const card3d = document.createElement("div");
    card3d.className = "card-3d";

    const inner3d = document.createElement("div");
    inner3d.className = "card-3d-inner";

    // ì•ë©´ â€“ í™”íˆ¬ ì´ë¯¸ì§€
    const frontFace = document.createElement("div");
    frontFace.className = "card-face card-front";
    frontFace.style.backgroundImage = `url('${HWATU_CARD_IMAGES[hwatuIndex]}')`;

    // ë’·ë©´ â€“ ë¦¬ë”© í…ìŠ¤íŠ¸
    const backFace = document.createElement("div");
    backFace.className = "card-face card-back";
    backFace.innerHTML = `
      <div class="reading-title">${UI_STRINGS[currentLang].readingTitle}</div>
      <div class="reading-body"></div>
    `;
    backFace.querySelector(".reading-body").textContent = reading;

    // Tap to reveal overlay
    const overlay = document.createElement("div");
    overlay.className = "tap-overlay";
    overlay.textContent = UI_STRINGS[currentLang].overlayTap;

    inner3d.appendChild(frontFace);
    inner3d.appendChild(backFace);
    card3d.appendChild(inner3d);
    card3d.appendChild(overlay);
    resultCardSlot.appendChild(card3d);

    showScreen("result");

    // ì²« í´ë¦­ â†’ flipí•´ì„œ ëœ»í’€ì´ ë³´ì—¬ì£¼ê¸°
    let revealed = false;
    card3d.addEventListener("click", () => {
      if (!revealed) {
        playFlipSound();
        card3d.classList.add("flipped");
        revealed = true;
      }
    });
  });
});

// ë‹¤ì‹œ ë½‘ê¸°
againBtn.addEventListener("click", () => {
  selectedAngelIndex = null;
  resultShown = false;
  currentHwatuIndices = [];
  lastAngelIndex = null;
  lastHwatuIndex = null;

  numberButtons.forEach(b => b.classList.remove("active"));
  cardButtons.forEach(b => b.classList.remove("disabled"));

  showScreen("intro");
});
</script>
</body>
</html>
